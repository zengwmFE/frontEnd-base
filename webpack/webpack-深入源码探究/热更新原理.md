## çƒ­æ¨¡å—æ›´æ–°åŸç†
### çƒ­æ¨¡å—æ›´æ–°çš„æ–¹æ³•
> `Hot Module Replacement`ç®€ç§°`HMR`ï¼Œå¯ä»¥é€šè¿‡ä¸åˆ·æ–°æ•´ä¸ªé¡µé¢ï¼Œåªä¿®æ”¹æ”¹å˜äº†çš„æ¨¡å—ã€‚`HMR`ä½œä¸º`webpack`å†…ç½®çš„åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡ï¼š1. å‘½ä»¤è¡Œè®¾ç½®--hotæ¥å®ç°ï¼›2. é€šè¿‡`HotModuleReplacementPlugin`æ¥å®ç°ã€‚

### å¯åŠ¨webpack-dev-server
#### æ ¹æ®`webpack`å†…çš„`package.json`ä¸­:
```
"bin": {
    "webpack-dev-server": "bin/webpack-dev-server.js"
  },
```
å¯ä»¥çŸ¥é“webpackçš„èµ·å§‹æ–‡ä»¶:`bin/webpack-dev-server.js`

#### å®ä¾‹åŒ–webpackï¼Œç”Ÿæˆcompiler,å¯åŠ¨ç¼–è¯‘çš„è¿‡ç¨‹
 
```
compiler = webpack(config);

```
#### å¯åŠ¨æœåŠ¡

```
// å¯åŠ¨æœåŠ¡
server = new Server(compiler, options, log);
serverData.server = server;

 if (options.socket) {
    server.listeningApp.on('error', (e) => {
      if (e.code === 'EADDRINUSE') {
        const client``Socket = new net.Socket();

        clientSocket.on('error', (err) => {
          if (err.code === 'ECONNREFUSED') {
            // No other server listening on this socket so it can be safely removed
            fs.unlinkSync(options.socket);

            server.listen(options.socket, options.host, (error) => {
              if (error) {
                throw error;
              }
            });
          }
        });

        clientSocket.connect({ path: options.socket }, () => {
          throw new Error('This socket is already used');
        });
      }
    });

    server.listen(options.socket, options.host, (err) => {...});
  } else {
    server.listen(options.port, options.host, (err) => {
      if (err) {
        throw err;
      }
    });
  }
```

#### æœ¬åœ°æœåŠ¡ä»£ç 
```
// '../lib/Server'
class Server{
  constructor(){
    //
    this.setupHooks();
    this.setupApp();
    // æ¯æ¬¡åˆå§‹åŒ–ä¹‹å‰éƒ½è¦å…ˆæŠŠåŸæœ‰çš„è¿›ç¨‹ç»™æ€æ‰
    killable(this.listeningApp);
    ...
    // åˆ›å»ºæœåŠ¡
     this.createServer();
  }
}
```

1. ç¬¬äºŒæ­¥ï¼Œåˆå§‹åŒ–`express`
```
  setupApp() {
    this.app = new express();
  }

```
2. åˆ›å»ºæœåŠ¡ï¼Œåˆ†ä¸ºä¸¤æ­¥ï¼Œ
  - å…ˆåˆ›å»ºäº†æœ¬åœ°`server`,å›è°ƒç»§ç»­åˆ›å»ºä¸€ä¸ª`websocketæœåŠ¡`ï¼Œå·²å®ç°å½“æœ¬åœ°ä»£ç å‘ç”Ÿæ”¹å˜äº†ï¼Œèƒ½å¤Ÿç¬¬ä¸€æ—¶é—´å°†æ›´æ–°åçš„ä»£ç æ¨é€åˆ°æµè§ˆå™¨äº†

```
  // ç„¶ååœ¨å®ä¾‹åŒ–serverè°ƒç”¨listenï¼Œåœ¨webpack-dev-serveræ–‡ä»¶ä¸­è°ƒç”¨
  
  listen(port, hostname, fn) {
    this.hostname = hostname;

    return this.listeningApp.listen(port, hostname, (err) => {
      this.createSocketServer();

      if (this.options.bonjour) {
        runBonjour(this.options);
      }

      this.showStatus();

      if (fn) {
        fn.call(this.listeningApp, err);
      }

      if (typeof this.options.onListening === 'function') {
        this.options.onListening(this);
      }
    });
  }
  // 1. å…ˆæ‰§è¡Œäº†createServeråˆ›å»ºäº†æœåŠ¡å®ä¾‹
  createServer() {
      this.listeningApp = http.createServer(this.app);
  }
```

æ€»ç»“æ¥è¯´ï¼š
ç®€å•åˆ†æè¿™ç¬¬ä¸€éƒ¨åˆ†ï¼Œ`webpack`åšäº†è¿™ä¹ˆå‡ ä»¶äº‹
1. é¦–å…ˆå¯åŠ¨äº†`webpack`ï¼Œç”Ÿæˆ`compiler`å®ä¾‹
2. é€šè¿‡`express`(ä¸ºä»€ä¹ˆä¸ä½¿ç”¨koa2ï¼Ÿ)ï¼Œåˆ›å»ºä¸€ä¸ªæœ¬åœ°æœåŠ¡å™¨ï¼Œè®©æµè§ˆå™¨èƒ½å¤Ÿåœ¨æœ¬åœ°ä»¥`ip`(ä¸¾ä¸ªğŸŒ°)çš„è®¿é—®ç”Ÿæˆçš„æ–‡ä»¶
3. å¯åŠ¨å®Œäº†æœ¬åœ°æœåŠ¡åï¼Œå†ä¼šå»åˆ›å»ºä¸€ä¸ª`websocket`æœåŠ¡å™¨ï¼Œä»¥ä¾¿æœ¬åœ°æ–‡ä»¶å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œèƒ½å¤ŸåŠæ—¶çš„é€šçŸ¥åˆ°æµè§ˆå™¨ç«¯ã€‚


### è¯¦ç»†çš„çœ‹ä¸€ä¸‹è¿™æ®µå†…å®¹åšäº†ä»€ä¹ˆäº‹å§

åˆšæ‰ç¬¬ä¸€éƒ¨åˆ†çš„åˆ†æï¼Œäº†è§£äº†å¤§æ¦‚çš„æµç¨‹ï¼Œå†æ¥åˆ†æä¸‹å…¶ä¸­å…·ä½“è¿˜åšäº†é‚£äº›äº‹
#### ä¿®æ”¹entryçš„è·¯å¾„
åœ¨å¯åŠ¨æœ¬åœ°æœåŠ¡å‰ï¼Œ
```
 updateCompiler(this.compiler, this.options);
 // const updateCompiler = require('./utils/updateCompiler');

```
åœ¨`updateCompiler.js`
åšäº†ä¸¤ä»¶äº‹:
1. è·å–æœ¬åœ°çƒ­æ›´æ–°ä»£ç çš„è·¯å¾„
2. è·å–`websocket`å®¢æˆ·ç«¯è·¯å¾„
```
addEntries(webpackConfig, options);
```

**addEntries**
```
    // websocket å®¢æˆ·ç«¯è·¯å¾„
    const clientEntry = `${require.resolve(
      '../../client/'
    )}?${domain}${sockHost}${sockPath}${sockPort}`;
    // çƒ­æ›´æ–°è·¯å¾„
    if (options.hotOnly) {
      hotEntry = require.resolve('webpack/hot/only-dev-server');
    } else if (options.hot) {
      hotEntry = require.resolve('webpack/hot/dev-server');
    }
```

> require.resolveçš„ä½œç”¨ï¼šä½¿ç”¨å†…éƒ¨çš„`require()`æœºåˆ¶æŸ¥è¯¢æ¨¡å—çš„ä½ç½®ï¼Œæ­¤æ“ä½œåªè¿”å›è§£æåçš„æ–‡ä»¶åï¼Œä¸ä¼šåŠ è½½è¯¥æ¨¡å—ã€‚å¦‚æœæ‰¾ä¸åˆ°æ¨¡å—ï¼Œåˆ™ä¼šæŠ›å‡º`MODULE_NOT_FOUND`é”™è¯¯ã€‚

æœ€åå°†è¿™æ®µç”Ÿæˆçš„`clientEntry`å’Œ`hotEntry`,ç”Ÿæˆ`additionalEntriesï¼ˆé¢å¤–å…¥å£ï¼‰`,æœ€åç”Ÿæˆæ–°çš„entry

```
const additionalEntries = checkInject(
        options.injectClient,
        config,
        webTarget
      )
        ? [clientEntry]
        : [];

      if (hotEntry && checkInject(options.injectHot, config, true)) {
        additionalEntries.push(hotEntry);
      }

      config.entry = prependEntry(config.entry || './src', additionalEntries);
```

**å¾—åˆ°å¦‚ï¼š**
```
// ä¿®æ”¹åçš„entryå…¥å£
{ entry:
    { index: 
        [
            // ä¸Šé¢è·å–çš„clientEntry
            'xxx/node_modules/webpack-dev-server/client/index.js?http://localhost:8080',
            // ä¸Šé¢è·å–çš„hotEntry
            'xxx/node_modules/webpack/hot/dev-server.js',
            // å¼€å‘é…ç½®çš„å…¥å£
            './src/index.js'
    	],
    },
}      

```

å¯ä»¥çŸ¥é“ï¼Œåœ¨å®ä¾‹åŒ–æœåŠ¡ä¹‹å‰å°±ä¼šå¾€`entry`å¢åŠ äº†ä¸¤ä¸ªå…¥å£æ–‡ä»¶ï¼Œè€Œè¿™ä¸¤ä¸ªå…¥å£æ–‡ä»¶ä¹Ÿä¼šè¢«æ‰“åŒ…åˆ°æœ€åç”Ÿæˆçš„`bundle`é‡Œé¢ï¼ˆ**å‚è€ƒwebpackå¤šå…¥å£æ‰“åŒ…**ï¼‰


#### ç›‘å¬æ¯æ¬¡webpackç¼–è¯‘å®Œæˆ
**this.setupHooks**
```
 setupHooks() {
      const { compile, done } = compiler.hooks;

      compile.tap('webpack-dev-server', invalidPlugin);
      done.tap('webpack-dev-server', (stats) => {
        this._sendStats(this.sockets, this.getStats(stats));
        this._stats = stats;
      });
    };
  }
```
ç»™`done`ç»‘å®šäº†ä¸€ä¸ªåŒæ­¥é’©å­ï¼Œç›‘å¬ç¼–è¯‘å®Œæˆï¼Œç„¶åæ‰§è¡Œ`this._sendStats`
```
  _sendStats(sockets, stats, force) {
      this.sockWrite(sockets, 'hash', stats.hash);
      this.sockWrite(sockets, 'ok');
  }

```
æ¯å½“`webpack`ç¼–è¯‘å®Œæˆä¸€æ¬¡ï¼Œå°±ä¼šç»™æµè§ˆå™¨å‘é€ä¸€ä¸ª`hash`æŒ‡ä»¤ï¼Œå°†å¯¹åº”ç¼–è¯‘çš„`hash`å€¼ï¼ŒåŒæ—¶å‘é€ä¸€ä¸ª`ok`çš„æŒ‡ä»¤ï¼Œè¿™æ ·æµè§ˆå™¨å¯ä»¥å°†æœ€æ–°çš„`hash`è¿›è¡Œä½¿ç”¨

#### webpackç›‘å¬æ–‡ä»¶æ›´æ”¹
ä¿®æ”¹ä»£ç ï¼Œå°±ä¼šè§¦å‘ç¼–è¯‘ï¼Œè¿˜éœ€è¦ç›‘å¬æœ¬åœ°ä»£ç çš„å˜åŒ–ï¼Œä¸»è¦æ˜¯é€šè¿‡`setupDevMiddleware`æ–¹æ³•å®ç°çš„ã€‚
1. å› ä¸º`webpack-dev-server`åªè´Ÿè´£å¯åŠ¨æœåŠ¡å’Œå‰ç½®å‡†å¤‡å·¥ä½œï¼Œæ‰€æœ‰æ–‡ä»¶ç›¸å…³çš„æ“ä½œéƒ½æ”¾åˆ°äº†`webpack-dev-middleware`ï¼Œä¸»è¦æ˜¯è´Ÿè´£æœ¬åœ°æ–‡ä»¶çš„ç¼–è¯‘å’Œè¾“å‡ºä»¥åŠç›‘å¬ã€‚
```
// node_modules/webpack-dev-middleware/index.js
compiler.watch(options.watchOptions, (err) => {
    if (err) {...}
});

// é€šè¿‡â€œmemory-fsâ€åº“å°†æ‰“åŒ…åçš„æ–‡ä»¶å†™å…¥å†…å­˜
setFs(context, compiler); 

```
- è°ƒç”¨`compiler.watch`
 - é¦–å…ˆå¯¹æœ¬åœ°æ–‡ä»¶è¿›è¡Œç¼–è¯‘æ‰“åŒ…ï¼Œè¿›è¡Œä¸€æ®µ`webpack`çš„ç¼–è¯‘
 - ç¼–è¯‘ç»“æŸçš„æ—¶å€™ï¼Œå¼€å¯å¯¹æœ¬åœ°æ–‡ä»¶çš„ç›‘å¬ï¼Œå½“æ–‡ä»¶å‘ç”Ÿå˜åŒ–ï¼Œç»§ç»­è¿›è¡Œ`webpack`ç¼–è¯‘ï¼Œ`compiler.watch`è¿™ä¸ªæ–¹æ³•ã€‚ç›‘å¬æœ¬åœ°æ–‡ä»¶çš„å˜åŒ–å¯ä»¥é€šè¿‡**æ–‡ä»¶çš„ç”Ÿæˆæ—¶é—´**æ˜¯å¦æœ‰å˜åŒ–ã€‚
- æ‰§è¡Œ`setFs`ï¼Œä¸»è¦æ˜¯ç›®çš„å°±æ˜¯å°†ç¼–è¯‘åçš„æ–‡ä»¶æ‰“åŒ…åˆ°å†…å­˜ã€‚æ‰€ä»¥è¯´åœ¨æ–‡ä»¶å¤¹æ²¡æœ‰å‘ç°`dist`ç›®å½•ï¼Œè¿™ä¸ªæ—¶å€™æ–‡ä»¶éƒ½åœ¨å†…å­˜ä¸­ï¼Œå› ä¸ºç›´æ¥è®¿é—®å†…å­˜ä¸­çš„æ–‡ä»¶è¦æ¯”ç›´æ¥è®¿é—®æœ¬åœ°æ–‡ä»¶è¦å¿«ï¼Œè€Œä¸”å¯ä»¥å‡å°‘å†™å…¥æ–‡ä»¶çš„å¼€é”€ï¼Œè¿™ä¸€åˆ‡éƒ½è¦ç”¨`memory-fs`

#### æµè§ˆå™¨æ¥æ”¶åˆ°çƒ­æ›´æ–°çš„é€šçŸ¥

åœ¨`done.tap('webpack-dev-server',function(){...})`ä¸­ï¼Œè°ƒç”¨äº†
```
this.sockWrite(sockets, 'hash', stats.hash);
this.sockWrite(sockets, 'ok');
```

```
// sockWrite
sockWrite(sockets, type, data) {
    sockets.forEach((socket) => {
      this.socketServer.send(socket, JSON.stringify({ type, data }));
    });
}
```
æ¥å‘é€ä¸åŒçš„`socket`çš„å‘½ä»¤ï¼š`hash`,`ok`
æœ€åå†™å…¥åˆ°`webpack-dev-server/client/index.js`æ–‡ä»¶ä¸­ï¼Œ

**socketæ¥æ”¶**
```
var onSocketMessage = {
  hash: function hash(_hash) {
        // æ›´æ–°è¦ä¼ è¾“ç»™æµè§ˆå™¨çš„hashå€¼
        status.currentHash = _hash;
    },
    ok: function ok() {
        sendMessage('Ok');
        // è¿›è¡Œæ›´æ–°æ£€æŸ¥ç­‰æ“ä½œ
        reloadApp(options, status);
    },
}

// ./util/reloadApp
function reloadApp(_ref, _ref2) {
    var hotEmitter = require('webpack/hot/emitter');
    hotEmitter.emit('webpackHotUpdate', currentHash);
}
```
æµè§ˆå™¨æ¥æ”¶çƒ­æ›´æ–°é€šçŸ¥ä¸»è¦åšäº†ï¼š
1. æœåŠ¡å™¨ç«¯ï¼Œåœ¨æ¥æ”¶åˆ°äº†`webpack`ç¼–è¯‘å®Œæˆä¹‹åçš„`done`é’©å­ï¼Œç„¶åå‘å®¢æˆ·ç«¯å‘é€äº†ä¸¤ä¸ªæŒ‡ä»¤ï¼š`hash`å’Œ`ok`
2. å®¢æˆ·ç«¯æ¥æ”¶åˆ°è¿™ä¸¤ä¸ªæ¶ˆæ¯ï¼Œä¼šåšä»¥ä¸‹æ“ä½œ
  - æ”¹å˜ä»£ç çŠ¶æ€ä¸­çš„`currentHash`ä»¥åŠè°ƒç”¨`reloadApp`æ–¹æ³•
  - åœ¨`reloadApp`ä¸­ï¼Œä½¿ç”¨`webpack`çš„`hotEmitter`çš„`Eventemit`ï¼ŒåŒæ—¶è§¦å‘äº†`webpackHotUpdate`äº‹ä»¶

**`webpackHotUpdate`åˆ°åº•åšäº†ä»€ä¹ˆäº‹å‘¢ï¼Ÿè¿™ä¸ªäº‹ä»¶åœ¨é‚£é‡Œæ³¨å†Œçš„ï¼Ÿ**
è¿™ä¸ªæ—¶å€™å°±éœ€è¦æ‹¿å‡ºä¸€ä¸ªè¢«é—å¿˜çš„æ‰“åŒ…å…¥å£äº†
```
{ entry:
    { index: 
        [
            // ä¸Šé¢è·å–çš„clientEntry
            'xxx/node_modules/webpack-dev-server/client/index.js?http://localhost:8080',
            // ä¸Šé¢è·å–çš„hotEntry
            'xxx/node_modules/webpack/hot/dev-server.js',
            // å¼€å‘é…ç½®çš„å…¥å£
            './src/index.js'
    	],
    },
}      

```
å³ï¼š`xxx/node_modules/webpack/hot/dev-server.js`

```
	var check = function check() {
		module.hot
			.check(true)
			.then(function(updatedModules) {
				if (!updatedModules) {
					window.location.reload();
					return;
				}

				if (!upToDate()) {
					check();
				}
			})
			.catch(function(err) {
          window.location.reload();
      })
	};
	var hotEmitter = require("./emitter");
	hotEmitter.on("webpackHotUpdate", function(currentHash) {
		lastHash = currentHash;
		if (!upToDate() && module.hot.status() === "idle") {
			check();
		}
	});
```
ä»è¿™é‡Œå¯ä»¥çŸ¥é“ï¼Œå½“è§¦å‘äº†`webpackHotUpdate`äº‹ä»¶ï¼Œå°±ä¼šæ›´æ–°`lastHash`ï¼Œæˆä¸ºæœ€åé¢çš„`hash`å€¼ï¼Œç„¶åè°ƒç”¨`check`å¯åŠ¨æ£€æŸ¥ã€‚ç›´æ¥åˆ·æ–°æ•´ä¸ªé¡µé¢ã€‚è¿™é‡Œå­˜åœ¨äº†ä¸€ä¸ª`module.hot.check(true)`è¿™æ ·çš„äº‹ä»¶ï¼Œè¿™ä¸ªæ–¹æ³•æ¥è‡ªäºçƒ­æ›´æ–°æœ€ä¸»è¦çš„æ’ä»¶`HotModuleReplacementPlugin`


### HotModuleReplacementPlugin
é‚£ä¹ˆ`HotModuleReplacementPlugin`æ˜¯æ€ä¹ˆæ ·æä¾›`module`çš„?å› ä¸º`HotModuleReplacementPlugin`ä½œç”¨äºæµè§ˆå™¨ï¼Œå¯ä»¥çœ‹ä¸€çœ‹æ‰“åŒ…åçš„æ–‡ä»¶ï¼š
å¯ä»¥æ‰¾åˆ°`module`çš„å®šä¹‰ï¼š`hotCreateModule`
```
 var module = installedModules[moduleId] = {
            hot: hotCreateModule(moduleId),
};
// ä»¥åŠ`hotCreateModule`
   function hotCreateModule(moduleId) {
        var hot = {
            check: hotCheck,
        }
        return hot;
    }
// hotCheck
    function hotCheck(apply) {
        hotApplyOnUpdate = apply;
        hotSetStatus("check");

        return hotDownloadManifest(hotRequestTimeout).then(function(update) {
            hotAvailableFilesMap = update.c; // éœ€è¦æ›´æ–°çš„æ–‡ä»¶
            hotUpdateNewHash = update.h; // æ›´æ–°ä¸‹æ¬¡çƒ­æ›´æ–°çš„hashå€¼
            hotSetStatus("prepare"); // å¼€å§‹è¿›å…¥çƒ­æ›´æ–°çš„å‡†å¤‡é˜¶æ®µ

            for(var chunkId in installedChunks)
			      {
              // å»é€šè¿‡jsonpè¯·æ±‚hot-update.js
 				      hotEnsureUpdateChunk(chunkId);
			      }    
        });
    }

function hotDownloadManifest(requestTimeout) {
   var request = new XMLHttpRequest();
   var requestPath = __webpack_require__.p + "" + hotCurrentHash + ".hot-update.json";
   request.open("GET", requestPath, true);
   request.timeout = requestTimeout;
   request.send(null);
}


function hotDownloadUpdateChunk(chunkId) {
var script = document.createElement("script");
script.charset = "utf-8";
script.src = __webpack_require__.p + "" + chunkId + "." + hotCurrentHash + ".hot-update.js";
if (null) script.crossOrigin = null;
document.head.appendChild(script);
}
```


éœ€è¦çŸ¥é“åœ¨è¿™é‡Œï¼Œåšäº†å“ªäº›äº‹æƒ…ï¼š
1. åˆ©ç”¨`ajax`å‘`hotCurrentHash.hot-update.json`å‘é€è¯·æ±‚
2. å¾—åˆ°è¦æ›´æ–°çš„**æ–‡ä»¶**å’Œè¦**æ›´æ–°çš„`hash`æ ‡è¯†**
3. é€šçŸ¥å‡†å¤‡æ›´æ–°
4. ç„¶åæ ¹æ®ä¸åŒçš„`chunkId`åˆ›å»º`script`å»é€šè¿‡`jsonp`è¯·æ±‚ä¸åŒå¯¹åº”çš„`hot-update.js`æ–‡ä»¶
**ä¸ºä»€ä¹ˆè¦ä½¿ç”¨`JSONP`æ¥è¯·æ±‚å‘¢ï¼Ÿ**
1. `JSONP`èƒ½å¤Ÿç›´æ¥æ‰§è¡Œ
2. `hot-update.js`æ–‡ä»¶æ˜¯ä»¥`webpackHotUpdate('chunkId',{....ä»£ç })`åŒ…è£…çš„ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œè¿™æ ·åœ¨è°ƒç”¨äº†`hot-update.js`æ–‡ä»¶çš„åŒæ—¶ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œè¿™æ®µä»£ç 

åœ¨`webpackHotUpdate`å‡½æ•°ä¸»è¦æ˜¯ä¸ºï¼š
1. å°†è¦æ›´æ–°çš„æ¨¡å—`moreModules`å¤åˆ¶ç»™å…¨å±€å˜é‡`hotUpdate`
2. `hotUpdateDownloaded()`æ›´æ–°å½“å‰çŠ¶æ€ä¸º`ready`,å»è°ƒç”¨`hotApply`è¿›è¡Œä»£ç çš„æ›¿æ¢ï¼Œ
```
window["webpackHotUpdate"] = function (chunkId, moreModules) {
    hotAddUpdateChunk(chunkId, moreModules);
} ;


function hotAddUpdateChunk(chunkId, moreModules) {
   for (var moduleId in moreModules) {
 			if (Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {
 				hotUpdate[moduleId] = moreModules[moduleId];
 			}
 		}
    
 		hotUpdateDownloaded();
}

 	function hotUpdateDownloaded() {
 		hotSetStatus("ready");
    var deferred = hotDeferred;
 		hotDeferred = null;
    if (hotApplyOnUpdate) {
 			Promise.resolve()
 				.then(function() {
 					return hotApply(hotApplyOnUpdate);
 				})
 				.then(
 					function(result) {
 						deferred.resolve(result);
 					},
 					function(err) {
 						deferred.reject(err);
 					}
 				);
 		} else {
 			var outdatedModules = [];
 			for (var id in hotUpdate) {
 				if (Object.prototype.hasOwnProperty.call(hotUpdate, id)) {
           // è·å–å½“å‰æ®æ¨¡å—
 					outdatedModules.push(toModuleId(id));
 				}
 			}
 			deferred.resolve(outdatedModules);
 		}
 	}
```


### hotApply(çƒ­æ›´æ–°æœ€é‡è¦çš„åœ°æ–¹ï¼šæ›´æ–°ä»£ç çš„æ›¿æ¢)


